# Pico "Cheatar"

The "cheater's guitar" or "cheatar" is designed to play guitar chords using a
(non-guitar-like) MIDI controller. It runs on a Raspberry Pi Pico (or Pico 2,
or variant of either) with two USB ports. If you'd like to try it, keep reading.

This version is the successor to [two WebMIDI based
versions](https://github.com/duhrer/cheatar) that came before. The starting
skeleton for this project was cloned from [my template
repository](https://github.com/duhrer/pico-midi-transformer), see that project
for more information.


## Hardware Prerequisites

First, you'll need compatible hardware, which means a Pico or compatible unit
with two USB ports. The [Adafruit Feather RP2040 with USB Type A
Host](https://www.adafruit.com/product/5723) is a good example of a unit that
has the second USB port built-in. You can also bring your own Pico (or
Pico-compatible) and wire it up as described in the documentation for the [OGX
Mini project](https://github.com/wiredopposite/OGX-Mini).

## Software Prerequisites

Once you have something to run the code on, you'll need to set up a build
environment. In the past, I have used:

1. The [Getting Started with Pico Guide](https://datasheets.raspberrypi.org/pico/getting-started-with-pico.pdf)
2. The [Pico VS Code extension](https://github.com/raspberrypi/pico-vscode)

Both of those are probably the easiest starting points, and if you hit upon
questions, there are lots of people working with them, so hopefully you can find
the guidance you need.

Personally, I use [distrobox](https://distrobox.it/) and [the docker container
created by `lukstep`](https://github.com/lukstep/raspberry-pi-pico-docker-sdk),
which I set up using commands like:

```
distrobox-create --image lukstep/raspberry-pi-pico-sdk -n pico-sdk
distrobox enter pico-sdk
```

## Checking out the Code

This project uses [git
submodules](https://git-scm.com/book/en/v2/Git-Tools-Submodules) for the
libraries it relies on. This means that if you
[clone](https://git-scm.com/docs/git-clone) this repository, you won't have all
the code you need to successfully build binaries.

Although there are multiple ways to manage submodules, the simplest way to get
everything you need is to use a command like:

```
git clone --recurse-submodules https://github.com/duhrer/pico-cheatar.git
```

## Building

Once you have a working build environment, you should be able to build the code
in this project using commands like:

```
mkdir -p build
cd build
cmake ..
make -j8
```

You should end up with binaries in various formats.

## Installing

The simplest way to install a binary is to boot the microcontroller into
`bootsel` mode. Hold down the `bootsel` button and plug your microcontroller
into USB. A USB drive will appear, and you can copy one the
`pico-midi-transformer.uf2` file generated by the build process onto your unit.
It will process and install the binary if it can. If it doesn't do anything,
make sure you're building for the right processor family, and try other test
binaries, like the examples that come with [the Pico
SDK](https://github.com/raspberrypi/pico-sdk).

If you're lucky enough to have a board with a reset button, all of the binaries
in this project also support entering `bootsel` mode by pressing the reset
button twice. You then copy the `pico-cheatar.uf2` file to the USB
drive as described above.

If you have a [pico probe](https://www.raspberrypi.com/products/debug-probe/) or
other debugging unit, and if your microcontroller exposes the ports you need,
you can use `openocd` to deploy binaries. With this method, you deploy the
`pico-cheatar.elf` file generated during the build process. Check the
"Getting Started with Pico Guide" for more info.

## Trying it Out

### Connect Everything

First, connect a controller to the "host" port on the microcontroller. Although
it can in theory be used with any MIDI controller, this project is primarily
tested with a [Korg Nanopad
2](https://www.korg.com/nl/products/computergear/nanopad2/), whose x/y pad is
ideal for simulating strumming. See [the tuning guide](docs/tuning.md) for tips
about configuring your Nanopad (2).

Connect the "client" port to a computer or other USB host.  The USB host needs
to run something that produces sound. I wrote a crude [web-based "ROMpler" I
wrote](https://duhrer.github.io/demos/guitarompler/) to use with this project,
but I also use it with guitar patches on a DX7 emulator like
[Dexed](https://github.com/asb2m10/dexed). You'll also need to configure
whatever is producing sound to connect to the "Pico Cheatar" MIDI input.

### Play Stuff

The MIDI controller is your input from this point on. Hold it with the X/Y pad
next to your preferred strumming hand and the pads where your other hand can
operate them like frets.

#### The "Strum"

The "mod wheel" on the MIDI controller is used to "strum" the guitar. In the
case of the Nanopad series, the X/Y pad acts as the mod wheel. When the wheel
passes the location of one of the "strings", a corresponding note is played (or
not played, in the case of chords that are not played on all strings).

The mod wheel only triggers notes when travelling between the zones that
correspond to a string. Holding the mod wheel near one string will not retrigger
that string.

Like a guitar, the strum is meant to support multiple styles, i.e. strumming
only in one direction, versus alternating back and forth strums.  It's also
meant to support different speeds.

#### The "Frets"

Notes played on the MIDI controller set the key of the guitar and the simulated
chord that is held. Pressing a note twice in rapid succession sets the "key".
Pressing the same note twice in rapid succession toggles between major and minor
chording.

Once the key is set, only the chords in the key are active. For example, if you
double-tap the C key, the chord is set to C major, and the chords that can be
played are:

* C major
* D minor
* E minor
* F major
* G major
* A minor
* B dim

Notes have a couple of other functions. Tapping a note once sets the chord to be
played, but only if it's in the current "key". So for example, if the key is C
major, holding the F key would set the chord to F major. If multiple notes in
the current key are held, the most recently pressed wins.

Tapping a note that's not in the current key toggles 7th chords. Note that by
tapping I mean that the "note on" triggers things. You can keep your finger on
the pad if that feels more natural.

If this all seems a bit much, check out the [tuning guide](docs/tuning.md),
which goes into a bit more of the rationale.  It's meant to make sense to play.
I hope it does.

#### Stuff to Make Things Sound More Guitarish

When the mod wheel is not triggering a string, any notes currently playing are
faded out using polyphonic aftertouch messages. This is meant to more closely
simulate the decay of guitar strings, without relying solely on the decay of the
patch you're connecting to.

Pressing any note on the MIDI controller will immediately "mute" all existing
strings. This is meant to act like a thumb across the strings, so you can stop
the strings from ringing out on demand.

#### Everything Else

All other MIDI messages from the MIDI controller (including pitchbend) are ignored.